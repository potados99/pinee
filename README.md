# tarvern-pin-archiver

*pinee*

메시지에 핀 꽂히면 아카이브 채널에다가 기록해주는 봇입니다.

## 설치

- ### [지금 설치 가능한 봇](https://discord.com/api/oauth2/authorize?client_id=786477765205426176&permissions=76880&scope=bot)

- [개발자가 개발용으로 혼자 쓰는 봇](https://discord.com/api/oauth2/authorize?client_id=786876831181045781&permissions=76880&scope=bot)

## 사용

### *pinee*가 하는 일

누군가가 메시지를 고정하면 해당 메시지를 아카이브 채널로 복사합니다.

> *"어떤 채널에다가 복사하나요?"*

토픽에 '[아카이브](https://github.com/potados99/tarvern-pin-archiver/blob/9bb1824ac8eabbf4ffd4d8dc7bdffb9b322e0e18/config.ts#L29)'라는 단어가 들어 있는 채널을 사용합니다.

> *"그런 채널이 없으면요?"*

메시지를 옮길 일이 생기면 *pinee*가 새 채널을 생성할지 물어봅니다. 이때 자동으로 만들어주는 채널을 사용할 수 있습니다. 채널을 미리 만들어 놓는 것도 좋습니다.

> *"*pinee* 설치 전에 있던 고정 메시지들은요?"*

`!!싱크` 명령을 쓰면 이전에 있던 메시지들도 옮겨줍니다. 몇 가지 옵션을 지정할 수 있습니다. 자세한 내용은 아래에서 다뤄용.

> *"실수로 메시지가 날아간다든가도 할 수 있나요?"*

원본은 건드리지 않습니다. *pinee*는 자기가 보낸 메시지만 수정/삭제합니다.

> *"망하면 복구할 수 있나요?"*

변경 사항은 아카이브 채널에만 생깁니다. 원본이 존재하는 한 아카이브 채널은 얼마든지 만들고 `!!싱크`할 수 있습니다.

> *"고정한 메시지를 고정 해제하면 어떻게 되나요?"*

아무 일 안 생깁니다. 아카이브 채널에 그대로 남아 있습니다.

> *"그럼 삭제하면요?"*

삭제해도 그대로 남아있습니다.

> *"그럼..메시지 내용을 수정하면요?"*

실시간으로 반영됩니다. 해당 메시지의 복사본을 아카이브 채널에서 찾아서 최신 내용으로 업데이트합니다.

> *"NSFW 채널에서 메시지 고정하면 누구나 다 볼 수 있나요?"*

선택할 수 있습니다. 고정 직후 *pinee*가 해당 메시지를 아카이브 채널로 복사할 것인지 묻습니다. ✅ 리액션을 추가하면 승인으로 간주하고 아카이브합니다.

### 명령어

다음 명령을 지원합니다.

#### !!싱크

> 이 명령은 서버 owner만 실행할 수 있습니다.

현존하는, 또는 현존했던 모든 고정 메시지를 아카이브합니다.

다음 두 가지 옵션을 지원합니다:

- `고정 해제된 메시지 포함하기`: 고정 해제된 메시지라도 고정했던 기록은 남습니다. 이 기록에 기반하여 한 번이라도 고정된 적 있는 모든 메시지를 아카이브합니다.
- `백업 덮어쓰기`: 아카이브 채널에 존재하는 모든 복사본(아카이브)을 지운 후 새로 아카이브합니다. 아카이브된 메시지의 순서가 바로잡아지기 때문에 좋습니다.

> *"시스템이 남겨 놓은 고정 기록을 지우면 어떻게 되나요?"*

`고정 해제된 메시지 포함하기` 옵션을 켠 상태라면 아카이브할 메시지를 찾을 때 **시스템의 고정 기록에 의존**합니다. 

따라서 고정 기록이 없으면 현재 메시지가 고정된 상태라도 찾지 못합니다. 고정 기록이 없지만 현재 고정된 메시지를 아카이브하려면 해당 옵션을 끄면 됩니다.

~~그냥 고정 기록을 지우지 마세여!!~~

> *"백업 덮어쓰면 아카이브 채널 자체가 지워지는 건가요?"*

해당 채널에서 *pinee*가 작성한 아카이브 메시지만 지웁니다.

> *"pinee가 만든 아카이브랑 다른 일반 메시지를 어떻게 구분하나요?"*

아카이브 메시지는 다음과 같은 특징이 있습니다:

- *pinee*가 작성했다.
- 아카이브 채널에 위치한다.
- 메시지에 embed가 들어가 있다.
- 해당 embed의 author 필드에 url이 있다.
- 그 url은 `https://discordapp.com/channels/${서버ID}/${채널ID}/${메시지ID}` 형식을 띤다.

위와 조건을 만족하는 메시지만 '*pinee*가 작성한 아카이브'로 간주됩니다.

> *"싱크 오래 걸리나요?"*

메시지 전송 빈도 제한이 있어 아주 빠르지는 않습니다.

## 권한

다음 권한을 사용합니다.

- `Manage Channels`: 아카이브 채널을 만들기 위해 사용합니다.
- `View Channels`: 전체 채널 중 아카이브 채널을 찾기 위해 사용합니다.
- `Send Messages`: 아카이브 채널에서 메시지를 보내기 위해 사용합니다.
- `Manage Messages`: 보낸 메시지를 수정하기 위해(진행상태 표시 등) 사용합니다.
- `Read Message History`: 지난 고정 메시지들을 가져오기 위해 사용합니다.
- `Add Reaction`: 사용자에게 계속할 것인지 물을 때에 예시 리액션(✅, ❌)을 추가하기 위해 사용합니다.

## 기타

> *"*pinee*는 어디에 사나요?"*

미국에 삽니다.

> *"서버 비용은요?"*

무료입니다.

## 업데이트 로그

### 2020.12.12 v1.1.0
- 메시지 원본으로 건너뛰는 링크 추가.
- 고정메시지 변경에 실시간으로 대응.
- 개선된 아카이브 명령 `!!싱크` 제공.

### 2020.12.10 v1.0.0
- 새로 고정된 메시지 아카이브.
- 수동 아카이브 명령 `!!고정메시지모두백업` 제공.